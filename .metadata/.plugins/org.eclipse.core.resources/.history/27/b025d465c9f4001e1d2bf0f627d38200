package com.app.PrimeNumGeneratorServer.PrimeservImpl;
import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.app.PrimeNumGeneratorServer.Entity.PrimeNumRequest;
import com.app.PrimeNumGeneratorServer.Entity.PrimeNumResponse;
import com.app.PrimeNumGeneratorServer.Entity.PrimeNum;
import com.app.PrimeNumGeneratorServer.PrimeRepo.primeRepository;
import com.app.PrimeNumGeneratorServer.seviceI.PrimeServiceI;

@Service
public class PservicesImpl implements PrimeServiceI
{

	@Autowired
	private primeRepository pRepository;
	
	@Override
	public PrimeNumResponse CalculatePrimeNumber(PrimeNumRequest pRequest) 
	{
		int start =pRequest.getFirstNumber();
		int end=pRequest.getLastNumber();
		
		
		long startTime = System.currentTimeMillis(); 
		List<Integer> primeNumList=new ArrayList<>();
		int count=0;
		
		for(int i=Math.max(start,2);i<=end;i++)
	      {
		    if(isPrime(i))
		    {
		    	primeNumList.add(i);
		    	count++;
		    }
		  }
		System.out.println("start time :-"+startTime);
		
		long endTime = System.currentTimeMillis();
		
		System.out.println("end time :-" +endTime);
		long elapseTime = endTime - startTime;
		
		System.out.println("elapseTime is :-" +elapseTime);
		
		PrimeNum saveData=new PrimeNum();
		saveData.setFirstNumber(start);
		saveData.setLastNumber(end);
		saveData.setPrimeCount(count);
		saveData.setElapsedTime(elapseTime);
		saveData.setTimeStamp(new Timestamp(System.currentTimeMillis()));
		saveData.setPrimeNumber(primeNumList);
    
		 
		
		PrimeNumResponse prm=new PrimeNumResponse();
		prm.setPrimes(saveData.getPrimeNumber());;
		prm.setElapsedTime(saveData.getElapsedTime());
		
		

		pRepository.save(saveData);
		
		
		return prm;
	}
	private static boolean isPrime(int num) 
    {
	     if(num<=1)
	      {
		    return false;
	      }
	     else
	      {
		     for(int i=2;i<=Math.sqrt(num);i++)
		       {
			     if(num%i==0)
			       {
				     return false;
			       }
		       }
	      }
	   return true;
    }
}













