package com.app.PrimeNumGeneratorServer.PrimeservImpl;


import java.sql.Timestamp;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.app.PrimeNumGeneratorServer.Entity.PrimeNumRequest;
import com.app.PrimeNumGeneratorServer.Entity.PrimeNumResponse;
import com.app.PrimeNumGeneratorServer.Entity.primeNum;
import com.app.PrimeNumGeneratorServer.PrimeRepo.primeRepository;
import com.app.PrimeNumGeneratorServer.seviceI.PrimeServiceI;

@Service
public class PservicesImpl implements PrimeServiceI
{

	@Autowired
	private primeRepository prepo;
	
	
	@Override
	public primeNum CalculatePrimeNumber(int startRange, int endRange) 
	{		
		
		long startTime = System.currentTimeMillis(); 
		List<Integer> primeNumList=new ArrayList<>();
		int count=0;
		
		for(int i=Math.max(startRange,2);i<=endRange;i++)
	      {
		    if(isPrime(i))
		    {
		    	primeNumList.add(i);
		    	count++;
		    }
		  }
		long endTime = System.currentTimeMillis();
		long elapseTime = endTime - startTime;
		
		primeNum pnm=new primeNum();
		pnm.setStartRange(startRange);
		pnm.setEndRange(endRange);
		pnm.setNumberOfPrime(count);
		pnm.setTimestamp(new Timestamp(System.currentTimeMillis()));
		
		PrimeNumResponse prm=new PrimeNumResponse();
		prm.setPrimes(primeNumList);
		prm.setElapsedTime(elapseTime);
		
		pnm.setResponse(prm); 
		prepo.save(pnm);
		return pnm;
	}
	private static boolean isPrime(int num) 
    {
	     if(num<=1)
	      {
		    return false;
	      }
	     else
	      {
		     for(int i=2;i<=Math.sqrt(num);i++)
		       {
			     if(num%i==0)
			       {
				     return false;
			       }
		       }
	      }
	   return true;
    }
}













